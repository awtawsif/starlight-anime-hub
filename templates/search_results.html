{% extends "base.html" %}

{% block title %}Search Results for "{{ search_query }}" | {{ config.WEBSITE_TITLE }}{% endblock %}

{% block content %}
<header class="text-center mb-12">
    <h1 class="text-4xl md:text-5xl font-bold text-green-400 mb-4 tracking-widest">
        SEARCH RESULTS
    </h1>
    <p class="text-lg text-green-300 font-light max-w-2xl mx-auto">
        {% if results %}
            Showing {{ results|length }} results for "<span class="text-green-300">{{ search_query }}</span>"
        {% else %}
            No results found for "<span class="text-green-300">{{ search_query }}</span>"
        {% endif %}
    </p>
</header>

<main class="flex-grow">
    {% if error_message %}
         <div class="text-center py-12 bg-red-900 border border-red-700 text-white">
            <p class="text-red-300 font-semibold text-lg mb-2">Transmission Error:</p>
            <p class="text-red-200 text-md">{{ error_message }}</p>
        </div>
    {% elif results %}
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6 md:gap-8">
            {% for item in results %}
                <a href="{{ url_for('main.anime_detail', anime_session_id=item.session, anime_title=item.title) }}" 
                   class="anime-card block bg-black border-2 border-green-400">
                    
                    <!-- Image container -->
                    <div class="relative w-full aspect-[2/3] overflow-hidden flex-shrink-0">
                        <img 
                            src="{{ url_for('main.proxy_image', url=item.poster) }}" 
                            alt="Poster for {{ item.title }}" 
                            class="absolute inset-0 w-full h-full object-cover border-b-2 border-green-400"
                            onerror="this.onerror=null;this.src='https://placehold.co/300x450/000000/00ff00?text=No+Image+Available&font=vt323';"
                            loading="lazy"
                        >
                        {% if item.score %}
                        <div class="absolute top-3 right-3 z-20">
                            <span class="inline-flex items-center px-2.5 py-1 bg-yellow-400 text-black font-bold text-xs border-2 border-yellow-400">
                                <svg class="w-4 h-4 mr-1 text-yellow-600" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.683-1.538 1.118l-2.8-2.034a1 1 0 00-1.176 0l-2.8 2.034c-.783.565-1.838-.197-1.538-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.92 8.72c-.783-.57-.38-1.81.588-1.81h3.462a1 1 0 00.95-.69l1.07-3.292z"></path></svg>
                                {{ "%.2f" | format(item.score) }}
                            </span>
                        </div>
                        {% endif %}
                        <!-- Bookmark Icon for Search Results -->
                        <button 
                            class="bookmark-icon absolute top-3 left-3 z-20 p-2 bg-black text-green-400 border-2 border-green-400"
                            title="Add to Bookmarks"
                            data-session-id="{{ item.session }}"
                            data-anime-title="{{ item.title | e }}"
                            data-poster="{{ item.poster | e }}"
                            data-type="{{ item.type | e }}"
                            data-year="{{ item.year | e }}"
                        >
                            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                        </button>
                    </div>
                    
                    <!-- Text content -->
                    <div class="p-4 text-center bg-black">
                        <h3 class="font-bold text-green-400 text-lg mb-1 truncate" title="{{ item.title }}">{{ item.title }}</h3>
                        <p class="text-sm text-green-300 font-medium">{{ item.type }} &middot; {{ item.year }}</p>
                    </div>
                </a>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center py-20 text-green-400">
            <svg class="mx-auto h-20 w-20 text-green-500 mb-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 15a4 4 0 004 4h9a5 4 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" />
            </svg>
            <p class="text-xl">No results found for "{{ search_query }}".</p>
            <p class="text-lg mt-2">Try a different search term or explore currently airing anime!</p>
        </div>
    {% endif %}
</main>
{% endblock %}

{% block modals %}
{% include '_modals.html' %}
{% endblock %}
